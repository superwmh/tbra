<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>Untitled Document</title>
<script src="../yui-utilities.js"></script>
<script src="../tbra-debug.js"></script>
</head>
<body>

<div id="demo">
	
<h2 class="tb-accordion-toggle">Introduce</h2>
<div class="tb-accordion-content">
	<p>
		TBra 是淘宝的JavaScript开发框架，基于YUI，目前包含的组件包括:
		<ul>
			<li>TB.common</li>
			<li>TB.dom</li>
			<li>TB.bom</li>
			<li>TB.util</li>
			<li>TB.widget</li>
			<li>TB.form</li>
		</ul>
		<button onclick="kkk.activate(1);">Next</button>
	</p>
</div>

<h2 class="tb-accordion-toggle">Example</h2>
<div class="tb-accordion-content">
	<pre>
	(function() {
		var ua = navigator.userAgent.toLowerCase();
		var _isOpera = ua.indexOf('opera') != -1,
			_isSafari = ua.indexOf('safari') != -1,
			_isGecko = !_isOpera && !_isSafari && ua.indexOf('gecko') > -1,
			_isIE = !_isOpera && ua.indexOf('msie') != -1, 
			_isIE6 = !_isOpera && ua.indexOf('msie 6') != -1;
			
		TB.bom = {
			isOpera: _isOpera,
			isSafari: _isSafari,
			isGecko: _isGecko,
			isIE: _isIE,
			isIE6: _isIE6
		}
	});	
	</prv>
</div>


<h2 class="tb-accordion-toggle">About Taobao UED</h2>
<div class="tb-accordion-content">
	<img src="http://pics.taobao.com/bao/album/promotion/ui_team_board.jpg" />
</div>
	
</div>

<style type="text/css">
#demo {
	width: 600px;
}
#demo h2 {
	margin:0;
}
.tb-accordion-toggle {
	color: #000;
	background: #eee;
}
.tb-accordion-toggle-active {
	color: #fff;
	background: #000;
}
.tb-accordion-content {
	background: #fff;
	overflow: hidden;	
}
</style>

<br />
<br />
<hr />
<br />
<br />

<style>
#demo2 {
	width: 800px;
}
#demo2 h2.tb-accordion-toggle {
	float: left;
	width: 25px;
	margin:0;
	padding:0;
	text-align: center;
	font: normal 20px 'SimHei';
}
#demo2 div.tb-accordion-content {
	float: left;
	width: 100px;
	overflow:hidden;
}	
</style>

<div id="demo2">
	
<h2 class="tb-accordion-toggle">简介</h2>
<div class="tb-accordion-content">
	<p style="width:300px;">
		TBra 是淘宝的JavaScript开发框架，基于YUI，目前包含的组件包括:
		<ul>
			<li>TB.common</li>
			<li>TB.dom</li>
			<li>TB.bom</li>
			<li>TB.util</li>
			<li>TB.widget</li>
			<li>TB.form</li>
		</ul>
	</p>
</div>

<h2 class="tb-accordion-toggle">范例</h2>
<div class="tb-accordion-content">
	<pre>
	(function() {
		var ua = navigator.userAgent.toLowerCase();
		var _isOpera = ua.indexOf('opera') != -1,
			_isSafari = ua.indexOf('safari') != -1,
			_isGecko = !_isOpera && !_isSafari && ua.indexOf('gecko') > -1,
			_isIE = !_isOpera && ua.indexOf('msie') != -1, 
			_isIE6 = !_isOpera && ua.indexOf('msie 6') != -1;
			
		TB.bom = {
			isOpera: _isOpera,
			isSafari: _isSafari,
			isGecko: _isGecko,
			isIE: _isIE,
			isIE6: _isIE6
		}
	});	
	</prv>
</div>


<h2 class="tb-accordion-toggle">关于淘宝U<br/>E<br/>D</h2>
<div class="tb-accordion-content">
	<img src="http://pics.taobao.com/bao/album/promotion/ui_team_board.jpg" />
</div>
	
</div>











<script type="text/javascript">
TB.widget.Accordion = new function() {
	
	var Y = YAHOO.util;
	
	var defConfig = {
		toggleClass: 'tb-accordion-toggle',
		contentClass: 'tb-accordion-content',
		toggleActiveClass: 'tb-accordion-toggle-active',
		eventType: 'click',		//click or mouse 点击触发or鼠标移动触发
		delay: 0.2,  			// available when eventType=mouse
		animate: true,			//是否动画显示
		duration: .5,     		//动画耗时
		direction: 'vertical',	//'horizontal(h)' or 'vertical(v)'. defaults to vertical.
		fixedHeight: false,		//是否显示固定高度
		fixedWidth: false		//是否显示固定宽度
	}
	
	this.decorate = function(container, config) {
		container = $(container);
		config = TB.applyIf(config || {}, defConfig);
		var toggles = $D.getElementsByClassName(config.toggleClass, null, container);
		var contentPanels = $D.getElementsByClassName(config.contentClass, null, container);
		var isHorizontal = (config.direction.toLowerCase() == 'horizontal') || (config.direction.toLowerCase() == 'h');
		
		var handle = {};
		var onActivateEvent = new Y.CustomEvent("activate", handle, false, Y.CustomEvent.FLAT);
		
		handle.currentIndex = -1;
		handle.toggles = toggles; 
		handle.activate = function(idx) {
			$D.removeClass(toggles, config.toggleActiveClass);
			$D.addClass(toggles[idx], config.toggleActiveClass);
			
			if (idx == handle.currentIndex) return;
			
			if (config.animate) {			
				if (handle.currentIndex >= 0) {
					var collapseAttrs = isHorizontal ? {width:{to:0}} : {height:{to:0}};
					var collapseAnim = new Y.Anim(contentPanels[handle.currentIndex], collapseAttrs, config.duration/2, Y.Easing.easeNone);
					collapseAnim.animate();
				}
				
				//expand activated content				
				var expandAttrs = null;
				if (isHorizontal) {
					expandAttrs = {width:{from:0, to:(config.fixedWidth||contentPanels[idx].scrollWidth)}};
				} else {
					expandAttrs = {height:{from:0, to:(config.fixedHeight||contentPanels[idx].scrollHeight)}};
				}
				var expandAnim = new Y.Anim(contentPanels[idx], expandAttrs, config.duration, Y.Easing.easeOut);
				expandAnim.onComplete.subscribe(function(){
					onActivateEvent.fire(idx);
				});
				expandAnim.animate();			
			} else {
				if (isHorizontal) {
					if (handle.currentIndex >= 0) {
						contentPanels[handle.currentIndex].style.width = '0';
					}
					contentPanels[idx].style.width = config.fixedWidth+'px' || 'auto';
				} else {
					if (handle.currentIndex >= 0) {
						contentPanels[handle.currentIndex].style.height = '0';
					}
					contentPanels[idx].style.height = config.fixedWidth+'px' || 'auto';
				}
				onActivateEvent.fire(idx);
			}
			
			handle.currentIndex = idx;
		}
		
		if (isHorizontal) {
			$D.setStyle(contentPanels, 'width', '0');
		} else {
			$D.setStyle(contentPanels, 'height', '0');
		}
		
		if (config.onActivate) {
			onActivateEvent.subscribe(config.onActivate);
		}
		
		var delayTimeId = null;
		toggles.forEach(function(t, i){
			if (config.eventType=='mouse') {
				$E.on(t, 'mouseover', function(ev, params) {
					delayTimeId = setTimeout(function(){
						params[0].activate(params[1]);
					}, config.delay*1000);
				}, [handle, i]);
				$E.on(t, 'mouseout', function(){
					clearTimeout(delayTimeId);
				});
			} else {
				$E.on(t, 'click', function(ev, params){
					params[0].activate(params[1]);
				}, [handle, i]);
			}
		})
		handle.activate(0);
		
		return handle;
	}	
}

var kkk = TB.widget.Accordion.decorate('demo', {
	animate:true,
	/*eventType:'mouse',*/
	/*fixedHeight: 300,*/
	onActivate: function(idx){
		//alert(idx);
	}
});

TB.widget.Accordion.decorate('demo2', {
	animate:false,
	fixedWidth:300,
	direction:'h'
});
</script>	
	
</body>
</html>
	
	
